<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/3.3.3/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://raw.githack.com/donmccurdy/aframe-extras/master/dist/aframe-extras.loaders.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <!-- <script src='js/aframe-ar-nft.js'></script> -->
    
    <style>
        * {
            box-sizing: border-box;
        }
        /* #debug {
          position: fixed;
          z-index: 10000;
          background-color: #fff;
          padding: 10px;
          top: 0;
          left: 0;
          width:100%;
          color:red;
          height:20px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 13px;
        } */
        #distance {
          position: fixed;
          z-index: 10000;
          background-color: #fff;
          padding: 10px;
          top: 0;
          left: 0;
          width:100%;
          color:red;
          height:20px;
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 13px;
        }
        #currentlocation {
          position: fixed;
          z-index: 10000;
          background-color: rgb(0, 0, 0);
          padding: 10px;
          bottom: 0;
          left: 0;
          width:100%;
          height:20px;
          color:rgb(255, 255, 255);
          display: flex;
          align-items: center;
          justify-content: center;
          font-size: 13px;
        }

    </style>
</head>


<body style='margin: 0; overflow: hidden;'>

    <!-- <div id="debug"></div> -->
    <div id="distance"></div>
    <div id="currentlocation"></div>

    <a-scene
        loading-screen="enabled: false;"
        vr-mode-ui="enabled: false"
		embedded
		arjs='sourceType: webcam; debugUIEnabled: false;'>

        
        <a-box 
            material="color: orange;" 
            scale="1 1 1" 
            gps-entity-place="latitude: 41.044862; longitude: 28.952108;" 
        >
        </a-box>

        <a-text
            color="red"
            id="text"
            value=""
            look-at="[gps-camera]"
            scale="1 1 1"
            gps-entity-place="latitude: 41.044862; longitude: 28.952108;"
        ></a-text>
        
        <!--apartman-->
        <a-image 
            src="assets/place.png" 
            look-at="[gps-camera]"
            scale="1 1 1" 
            gps-entity-place="latitude: 41.045141; longitude: 28.951875;"
        ></a-image>
        <a-text
            color="red"
            id="text1"
            value=""
            look-at="[gps-camera]"
            scale="1 1 1"
            gps-entity-place="latitude: 41.045145; longitude: 28.951800;"
        ></a-text>

        <!--ev-->
        <a-image 
            src="assets/place.png" 
            look-at="[gps-camera]"
            scale="1 1 1" 
            gps-entity-place="latitude: 41.045116; longitude: 28.951977;"
        ></a-image>
        <a-text
            color="red"
            id="text2"
            value=""
            look-at="[gps-camera]"
            scale="1 1 1"
            gps-entity-place="latitude: 41.045116; longitude: 28.951977;"
        ></a-text>

        <!--bim-->
        <a-image 
            src="assets/place.png" 
            look-at="[gps-camera]"
            scale="1 1 1" 
            gps-entity-place="latitude: 41.044728; longitude: 28.951982;"
        ></a-image>
        <a-text
            color="red"
            id="text3"
            value=""
            look-at="[gps-camera]"
            scale="1 1 1"
            gps-entity-place="latitude: 41.044728; longitude: 28.951982;"
        ></a-text>

        <!--Ã§elebi-->
        <a-image 
            src="assets/place.png" 
            look-at="[gps-camera]"
            scale="1 1 1" 
            gps-entity-place="latitude: 41.044623; longitude: 28.952519;"
        ></a-image>

        <!--gobek-->
        <a-image 
            src="assets/place.png" 
            look-at="[gps-camera]"
            scale="1 1 1" 
            gps-entity-place="latitude: 41.045756; longitude: 28.953367;"
        ></a-image>
        

        <a-camera
            gps-camera 
            maxDistance="20" 
            gpsMinDistance= "1" 
            rotation-reader
                         
        ></a-camera>
        <!-- gps-camera="minDistance:1; maxDistance:100" 
            look-controls-enabled="false" 
            arjs-look-controls="smoothingFactor: 0.1"
        -->
    </a-scene>

    <script>
        window.addEventListener('load', () => {
          const distanceMsg = document.querySelector('[gps-entity-place]').getAttribute('distanceMsg');
          const text = document.getElementById('text');
          const text1 = document.getElementById('text1');
          const text2 = document.getElementById('text2');
          const text3 = document.getElementById('text3');
          const dstnc = document.getElementById('distance');

          text.addEventListener('gps-entity-place-update-position', (event) => {
            // document.getElementById('debug').textContent = `${event.detail.distance.toFixed(2)} meters far from you`;
            text.setAttribute('value', text.getAttribute('distanceMsg') + ' left');
            dstnc.innerHTML = `~ ${text.getAttribute('distanceMsg')} left`;
          });
          text1.addEventListener('gps-entity-place-update-position', (event) => {
            text1.setAttribute('value', text1.getAttribute('distanceMsg') + ' left');
          });
          text2.addEventListener('gps-entity-place-update-position', (event) => {
            text2.setAttribute('value', text2.getAttribute('distanceMsg') + ' left');
          });
          text3.addEventListener('gps-entity-place-update-position', (event) => {
            text3.setAttribute('value', text3.getAttribute('distanceMsg') + ' left');
          });

        });
    </script>

    <script>
        //get current location (onload)
        window.onload = () => {
            if( navigator.geolocation ) {
                    // Call getCurrentPosition with success and failure callbacks
                    const watchId = navigator.geolocation.watchPosition( success, fail );
            }
            else {
                alert("Sorry, your browser does not support geolocation services.");
            }

            function success (position) {
                document.getElementById('currentlocation').innerHTML=`latitude: ${position.coords.latitude.toFixed(6)}; longitude: ${position.coords.longitude.toFixed(6)}`;
            }
            
            function fail () {
                document.getElementById('currentlocation').innerHTML=`Unable to get your location / User denied Geolocation`;
            }
        }

      </script>
</body>

<!-- look-controls-enabled="false" 
            arjs-look-controls="smoothingFactor: 0.1" -->